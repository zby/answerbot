# History

{% for observation in history.observations[:-1] %}
## Observation {{ loop.index }}

**Operation:** {{ observation.operation }}
{% if observation.goal %}
**Goal:** {{ observation.goal }}
{% endif %}
**Source:** {{ observation.source or 'N/A' }}

{% set related_kps = history.find_related_knowledge_pieces(observation) %}
{% if related_kps %}
### What have we learned:
{% for kp in related_kps %}
- {{ kp.content }}
  {% for quote in kp.quotes %}
{{ quote | indent_and_quote }}
  {% endfor %}
{% endfor %}
{% else %}
No related knowledge pieces.
{% endif %}

{% endfor %}

## Current Retrieval

{% with observation = history.observations[-1] %}
## Observation {{ history.observations | length }}

**Operation:** {{ observation.operation }}
{% if observation.goal %}
**Goal:** {{ observation.goal }}
{% endif %}
**Source:** {{ observation.source or 'N/A' }}

**Content:**
{{ observation.content | indent_and_quote }}

{% set related_kps = history.find_related_knowledge_pieces(observation) %}
{% if related_kps %}
### What have we learned:
{% for kp in related_kps %}
- {{ kp.content }}
  {% for quote in kp.quotes %}
{{ quote | indent_and_quote }}
  {% endfor %}
{% endfor %}
{% else %}
No related knowledge pieces.
{% endif %}{% endwith %}